<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>pp - sp console panel</title>
    <link rel="stylesheet" href="statics/css/bootstrap.min.css">
    <link rel="stylesheet" href="statics/css/main.css">
</head>
<body>

<header><a href="/">Welcome to sp console panel !</a><a href="javascript:void(0)" id="logout" class="float-right">log out</a></header>

<div class="container-fluid">

    <div class="row">

        <div class="col-1">

            <div class="list-group">
                <a href="/pp.html" class="list-group-item list-group-item-action active">pp list</a>
                <a href="/files.html" class="list-group-item list-group-item-action">files</a>
                <a href="/setting.html" class="list-group-item list-group-item-action">setting</a>
            </div>

        </div>

        <div class="col-11">

            <table class="table table-bordered table-hover">
                <thead>
                    <tr>
                        <th scope="col">#ID</th>
                        <th scope="col">network_address</th>
                        <th scope="col">wallet_address</th>
                        <th scope="col">info</th>
                        <th scope="col">online</th>
                        <th scope="col">operation</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

    </div>

</div>

<span clas="oi"></span>
<script src="statics/js/jquery-3.3.1.min.js"></script>
<script src="statics/js/bootstrap.min.js"></script>
<script src="statics/js/main.js"></script>
<script src="statics/js/table.js"></script>
<script type="text/javascript">
$(function() {
    var getPPList = function() {
        API.call("GET", "/pp", {}, function(response) {
            if (response.errcode == 200 && response.data.length > 0) {
                $("tbody").empty()
                $.each(response.data, function(idx, item) {

                    div = "<ul style=\"margin: 0;\">"
                    div += "<li>cpu: "+item.cpu_info+"</li>"
                    div += "<li>disk: "+item.disk_size+"</li>"
                    div += "<li>mac: "+item.mac_address+"</li>"
                    div += "<li>memory: "+item.memory_size+"</li>"
                    div += "</ul>"

                    state = item.state == 1 ? "<span class=\"text-success\">online</span>" : "<span class=\"text-danger\">offline</span>"
                    operation = "<a href=\"javascript:void(0)\" role=\"backup\" data-wallet-address=\""+item.wallet_address+"\"  class=\"badge badge-success\">backup</a>&nbsp;&nbsp;"
                    operation += "<a href=\"javascript:void(0)\" class=\"badge badge-danger\">kick</a>"

                    row = [item.id, item.network_address, item.wallet_address, div, state, operation]

                    $("tbody").addRow(row)
                })
            }
        })
    }

    getPPList()
    // setInterval(function() {
    //     getPPList()
    // }, 2000)

    $("a[role=backup]").click(function() {
        walletAddress = $(this).attr('data-wallet-address')
        walletAddress.replace('data-', '')
        if (walletAddress != "") {
            API.call("POST", "/pp/"+walletAddress+"/backup", {}, function() {
            })
        }
    })

})
</script>
</body>
</html>
